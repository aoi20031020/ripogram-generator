研究の課題と評価指標
本章では、本プロジェクトで扱うリポグラム生成タスクを形式的に定義し、そこから導かれる研究の課題と評価指標を整理する。これにより、第4章以降で述べる提案手法や実験設定が、どのような観点から評価されるべきかを明確にする。
タスク定義と研究の課題
本研究で扱うタスクは、「与えられた日本語文と禁止文字集合に対して、その禁止文字を一切含まない日本語文を生成すること」である。入力としては、元となる日本語文（ことわざ、小説の一文、日常文など）と、禁止する文字の集合を与える。禁止文字は、ひらがな一文字の集合として指定する場合（例：「い,さ」）に加え、「あ行」のように行単位で複数の仮名をまとめて禁止する場合も想定する。アルゴリズムは、この入力に対して禁止文字を含まない新しい文を出力するが、出力文が単に禁止文字を避けていれば良いのではなく、日本語として自然であり、元文の意味内容を大きく損なっていない必要がある。
形式的には、入力文を\(x\)、禁止文字集合を\(B\)、出力文を\(y\)としたとき、次の条件を満たす\(y\)を生成することが目標となる。
制約遵守（Constraint）
制約遵守とは、出力文\(y\)に含まれるすべての文字（あるいは読み）が、禁止集合\(B\)に属さないことをいう。文字ベース制約では表記上の文字列、読みベース制約では形態素解析により得られた読みの仮名列に対してこの条件を課す。
たとえば、元文xが「彼は朝ごはんを食べなかった。」で、禁止文字集合Bが「あ」のとき、次のような出力は制約違反となる。
█(y^1:「彼は朝飯を食べなかった。」#)
これに対して、意味を保ちつつ「あ」を避けた出力の一例は以下のような文である。
█(y^2:「彼は朝食を食べなかった。」#)
ここでは「朝ごはん(あさごはん)」を「朝食(ちょうしょく)」に言い換えることで、「あ」を含まない表現に置き換えている。
意味保持（Semantic Preservation）
意味保持とは、元文\(x\)と出力文\(y\)の意味的類似度が十分に高いことをいう。完全な同義である必要はないが、元文が持つ主要な情報や含意が失われていないことが望ましい。
たとえば、元文xが「彼女は東京でエンジニアとして働いている。」に対して、
█(y^1:「彼女は東京で技術者として勤務している。」#)
は「エンジニア／技術者」「働いている／勤務している」といった語彙の違いはあるものの、場所（東京）と職種（エンジニア）という主要な情報が保たれており、意味保持されているとみなせる。
一方で、以下の出力文は意味保持しているとはみなせない。
█(y^2:「彼女は大阪で学生生活を送っている。」#)
この出力文は、勤務地が東京から大阪に変わり、職業もエンジニアから学生に変わっているため元文の意味内容から大きく逸脱しており、意味保持がなされていない例といえる。
文法性・自然性（Fluency）
文法性・自然性とは、出力文\(y\)が日本語として自然に読めることをいう。多少のスタイル変化（です・ます体から常体への変化など）は許容するが、意味が理解しづらいほどの文法破綻は避ける。
たとえば、元文x「この本はとてもおもしろかったです。」に対して、
█(y^1:「この本はとてもおもしろかった。」#)
は、丁寧体から常体へのスタイル変化はあるものの、日本語として自然であり、文法性・自然性の観点からは問題ないとみなせる。
一方で、以下の出力文は日本語として自然とはいえない。
█(y^2:「本とてもおもしろいでした。」#)
この出力文は、語順や活用が不自然で、母語話者にとって違和感の大きい文は、たとえ禁止文字を避けていても、文法性・自然性を満たしていない例である。
 
研究の課題
このタスク定義に基づき、本プロジェクトで特に検証したい研究課題（Research Question; RQ）は次の三点である。
RQ1: 日本語リポグラム生成において、逐次生成方式（sequential）は一発生成方式（oneshot）に比べて、どの程度制約遵守率を改善できるか。
RQ2: 制約遵守率を維持・向上させたうえで、元文の意味保持や自然さをどの程度保てるか。その際、両方式の語彙置換率（Vocabulary Replacement Rate; VRR）や語彙多様性（Type-Token Ratio; TTR）にはどのような差が生じるか。
RQ3: 制約タイプ（単音禁止/行禁止など）や文長・文ジャンルの違いによって、両方式の得意・不得意はどのように変化するか。
評価指標と測定項目
上記の研究課題を検証するため、本研究では「制約をどの程度厳格に守れるか」「どの程度まで元文の意味と自然さを保てるか」「現実的な時間内で動作するか」という観点から、二つの方式を多面的に比較する。そのために、いくつかの定量指標を組み合わせて生成結果を評価することとし、データセットや具体的な実験条件については第5章で詳述し、ここでは各指標の役割に焦点を当てる。
主指標
まず主指標として、制約遵守率（Constraint Satisfaction Rate）を用いる。これは、生成文の読みが禁止かなを一切含まない文の割合を表す指標であり、リポグラムとして成立しているかどうかを判定する最も重要な基準である。逐次生成方式と一発生成方式のどちらがより高い制約遵守率を達成できるかを比較することで、RQ1に対応する検証を行う。
例えば、ある条件下で生成した文の総数を(N)、そのうち読みベースのチェックで制約違反が一度も検出されなかった文の数を(N_"success"  )とすると、制約遵守率は次式で定義される。
█("ConstraintRate" =N_"success" /N#(1) )
補助指標（書き換えの性質・品質）
補助指標としては、書き換えの性質や品質を評価するために、語彙置換率（VRR）、語彙多様性（TTR）、n-gram反復率、および実行時間（Time per Output）を用いる。
VRRは元文と生成文のトークン列を比較し、置き換わったトークンの割合を測定する指標である。値が高いほど大きな言い換えが行われていることを意味し、意味保持とのトレードオフを捉えるために用いる（RQ2）。ここで、Xは元文のトークン列、X_diffはそのうち生成文と異なるトークンの集合とする。
█("VRR" =|X_"diff"  |/|X| #(2) )
TTRは生成文におけるユニーク語彙の割合を測定し、過度な語彙の繰り返しや極端に限定された語彙への偏りがないかを確認する指標であり、こちらもRQ2の検証に寄与する。Yは生成文のトークン列、types(Y)はYに含まれるユニーク語彙の集合とする。
█("TTR" =|"types" (Y)|/|Y| #(3) )
n-gram反復率は、同一のbi-gramやtri-gramがどの程度繰り返されているかを測定し、不自然な反復や定型表現への過度な依存を検出するために用いる。N_ngramは全n-gramの数、N_ngram,repは2回以上出現したn-gramの数とする。
█(〖"RepRate" 〗_n=N_"ngram,rep" /N_"ngram"  #(4) )
実行時間は、1文あたりの処理時間を測ることで、逐次生成方式と一発生成方式の計算コストの違いを把握し、RQ1を「実用性」の観点から評価するための指標となる。
比較対象となる生成方式
以上のタスク定義と評価指標に基づき、本研究では「一発生成」と「逐次生成」という二つの方式を比較する。一発生成方式（oneshot）は、元文と禁止文字集合をまとめてLLMへの入力とし、単一の応答としてリポグラム文を生成する方式である。プロンプト設計のみで制約を伝える一般的な利用形態に近く、対話型LLMをそのまま用いた素朴なベースラインとして位置づけられる。
これに対して逐次生成方式（sequential）は、元文を文や文節に分割し、禁止文字を含むトークンを検出したうえで、その部分のみを文脈を考慮しながら順番に書き換えていく方式である。各ステップで読みベース制約を強くかけ直し、必要に応じて再試行を行うことで、制約遵守率の向上を狙った「リポグラム専用」の強力な方式とみなせる。両方式を同一のデータセット・同一のモデル条件のもとで評価することで、日本語リポグラム生成においてどのようなトレードオフが存在するのかを明らかにすることが、本章で整理した研究課題の核心である。
