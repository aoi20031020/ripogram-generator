第5章	実験の設定と結果の概要
本章では、日本語リポグラム生成手法の評価に用いたデータセットと実験条件、および現時点で得られている定量的な結果とその解釈について述べる。
5.1	データセット
実験には、Tatoeba由来の日本語例文コーパスを元に構築した制約付きデータセットを用いた。まず、文字数20〜60程度で、ひらがなまたは漢字を含む文を条件として抽出し、ランダムに200文を選択してベース文集合を作成した。その後、各ベース文に対して複数の禁止文字集合（banned_chars）を付与することで、制約付きパターンを展開し、最終的に465パターンからなる評価用データセットを構成した。
禁止文字集合は、単音禁止のeasy条件と行禁止のmedium条件に大別される。easy条件では「い」「さ」「ら」など頻度の中程度の仮名を1文字だけ禁止し、medium条件では「あ,い,う,え,お」や「か,き,く,け,こ」といった行単位の禁止を課した。各ベース文に対し、禁止セット内のいずれかのかなが表記に含まれる場合のみ、その組み合わせを1パターンとして採用し、1文あたり最大3パターンまでに制限している。これにより、現実的な難易度の制約付き文集合を構成した。評価用データセットの一部を図 3に示す。
 
図 3 データセットのイメージ
5.2	実験条件と評価指標
モデルにはOpenAIのGPT系LLMを用い、実験時点ではgpt-4.1-nanoを基準モデルとした。oneshotとsequentialの双方について、温度やトップ確率などの生成パラメータは共通設定とし、各パターンに対して1回ずつ生成を行った。生成と評価は専用のバッチスクリプトにより自動化し、その結果を行ごとのレコードを持つ表形式データとして保存した。
評価指標としては、第3章で定義した読みベース制約遵守率を主指標としつつ、語彙置換率（VRR）、語彙多様性（TTR）、n-gram反復率、実行時間を併用した。制約遵守率は、生成文の読み（カタカナをひらがなに正規化した文字列）に禁止かなが一切含まれない文の割合として定義し、VRRは元文と生成文のトークン列の差分から「どれだけ単語が置き換わったか」を近似的に測る指標である。TTRとn-gram反復率は生成文の多様性や反復傾向を捉える指標であり、実行時間は1文あたりの処理時間を通じて方式ごとの計算コストを評価するために用いた。主な実験条件と使用した指標の対応関係を表 2にまとめる。
表 2実験条件と評価指標
項目	設定
モデル	gpt-4.1-nano（OpenAI GPT系LLM）
生成パラメータ	温度やtop-pなどは両方式で共通設定
実行回数	各データパターンにつき各方式1回生成
主指標	読みベース制約遵守率
補助指標	語彙置換率（VRR）、語彙多様性（TTR）、n-gram反復率、1文あたり実行時間
5.3	制約遵守率と方式比較
まずRQ1「逐次生成方式は一発生成方式に比べて、どの程度制約遵守率を改善できるか」を検証するため、データセット全体に対する読みベース制約遵守率を比較した。結果を図 4に示す。readingベースの成功率は、sequentialが91.6%（426/465）、oneshotが12.5%（58/465）であり、逐次生成方式が一発生成方式を大きく上回ることが分かる。
 
図 4 生成方式別の制約遵守率
さらに、制約タイプ別の成功率を図 5に示す。とくに行禁止（medium）条件において、oneshotの成功率が大きく低下する一方で、sequentialは高い成功率を維持しており、日本語の制約が厳しい条件ほど逐次生成方式の優位性が顕著になる傾向が見られた。また、各idごとに「どちらが成功したか」を比較したところ、sequentialのみ成功したペアが368（79.1%）、両方式とも成功または失敗の「同じ結果」が97（20.9%）、oneshotのみが成功した例は0であった。対応のあるt検定でも、成功フラグ（0/1）の差はt≈42, p≪0.001と、統計的に極めて有意な差が確認されている。
 
図 5 制約タイプ別×生成方式別の制約遵守率
 

5.4	VRR・TTRとエラー分析
次に、RQ2「制約遵守率を維持・向上させたうえで、元文の意味保持や自然さをどの程度保てるか」を検証するため、両方式とも制約を満たしたペア（58件）のみを対象に、VRRとTTRを比較した。図 6は、このときのVRRとTTRの分布を示している。VRRについては、oneshotの値がsequentialよりも有意に高く（平均差≈0.33, p≪0.001）、oneshotの方がより大きな言い換えを行う傾向があることが分かる。一方で、TTRには有意な差が見られず、語彙多様性そのものは両方式で大きくは変わらない。このことから、逐次生成方式は制約を守りながら原文に近い表現にとどまりやすく、oneshotはより大胆な言い換えを行いやすいという性質が示唆される。
 
図 6 VRRとTTRの散布図
 

RQ3「制約タイプや文長・文ジャンルによって両方式の得意・不得意はどのように変化するか」については、エラー分析を通じて定性的に検討した。禁止文字が頻出助詞（「は」「が」「を」など）に含まれる場合や、行禁止によって多数の仮名が一度に制約対象となる場合、あるいは読みベース制約により漢字語の読みが制限される場合などでは、両方式とも意味保持が難しくなることが確認された。図 7に、代表的な成功例・失敗例をいくつか示す。oneshotでは文全体を丸ごと言い換える過程で意味が原文から大きく逸脱してしまう例があり、sequentialでは局所的な修正を重ねるうちに文全体の統一感がやや損なわれる例が見られた。これらの事例は、前章で述べたWebアプリケーション上で元文・制約・両方式の出力を並べて提示することで、今後の主観評価や改善策の検討に活用できる。
 
図 7 成功例・失敗例（元文／制約／各方式の出力）
