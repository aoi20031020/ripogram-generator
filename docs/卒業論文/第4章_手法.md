# 第4章 手法（Methods）

## この章のゴール

- 「提案する枠組み（フレームワーク）」を仕様として記述する（入出力・モジュール・制御）。
- oneshot / sequential は枠組み内の実装差分として、同じ評価に乗る形で定義する。

## 4.1 全体アーキテクチャ

### 4.1.1 システム概要
- 入力処理（`B` の展開/正規化）、候補生成（LLM）、制約検査（表記/読み）、再生成制御、をモジュールとして分解する。

### 4.1.2 パイプライン構造（CHECK → GENERATE → REWRITE）
- CHECK: 違反箇所検出（表記/読み）。
- GENERATE: 代替候補の生成（oneshot/局所書き換え）。
- REWRITE: 候補の適用、必要なら再試行。

### 4.1.3 逐次生成と一発生成の違い
- 介入粒度（全文 vs トークン/局所）と、コスト（API回数/時間）を整理する。

## 4.2 制約チェックアルゴリズム

### 4.2.1 文字レベルチェック
- 正規化（ひらがな/カタカナの扱い、全角半角、など）を明示する。

### 4.2.2 読みレベルチェック
- 形態素解析で得る読みの正規化（カタカナ→ひらがな）を明示する。
- 解析失敗時の扱い（第3章の前提に従う）をここで実装方針に落とす。

### 4.2.3 複合制約チェック（文字＋読み）
- 表記と読みのどちらかが違反なら違反、とする等の判定規約を明記する。

## 4.3 生成アルゴリズム

### 4.3.1 LLM 生成（共通部）
- プロンプトの入出力形式（禁止集合の提示形式、出力は文のみ等）を定義する。
- 生成パラメータ（temperature 等）をここで“方針”として述べ、実験値は第6章へ。

### 4.3.2 oneshot（全文一括）
- 一回の生成→制約チェック→失敗なら再生成、の制御を記述する。

### 4.3.3 sequential（局所介入）
- 違反トークン検出→文脈付きで言い換え→再チェック→必要なら反復、を記述する。
- 局所修正と全文置換の切り替え条件（多違反時など）を明確化する。

### 4.3.4 意味保持・自然性を損ねないための選別（任意）
- 生成候補が複数ある場合の選別方針（BERT類似度等）を、枠組み要素として採用するか明示する。

## 4.4 再生成アルゴリズム
- 失敗判定、再生成戦略、停止条件（最大試行回数、妥協条件）を定義する。

## 図表候補
- （図）枠組み全体（入力→チェック→生成→再生成→出力）。
- （表）oneshot/sequential の差分（介入単位、API回数、期待される成功率/品質）。

## 流用元候補
- `docs/CW研究会/第4章_提案手法とシステム構成.md`
- `docs/中間報告/第4章_提案手法とシステム構成.md`

