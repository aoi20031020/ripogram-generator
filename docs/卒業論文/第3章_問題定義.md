# 第3章 問題定義（Problem Definition）

本章では，本研究で扱う日本語リポグラム生成タスクを形式的に定義する。とくに，入力（元文と禁止集合），出力（生成文），および制約遵守の判定方法（表記ベース／読みベース）を明確化し，以降の手法設計（第4章）と実験評価（第6〜7章）が再現可能になるように整理する。また，本研究は「読み（仮名列）を取って制御する」という立場を取るため，形態素解析による読み取得と正規化，および解析失敗時の扱いも含めて前提を定める。

## 3.1 タスク定義

本節では，本研究の入力・出力・成功条件を定義する。とくに，禁止集合の扱い（行指定を含む入力 \(B\) の正規化）と，表記ベース制約／読みベース制約の二つの制約定義を整理する。

### 3.1.1 入力の定義
本研究の入力は，日本語文 \(x\) と禁止集合 \(B\) である。ここで \(x\) は，ことわざ・例文などの文単位テキストを想定する。禁止集合 \(B\) は，ひらがな1文字の集合として指定する場合（例：「い，さ」）に加え，「あ行」のように行単位で複数の仮名をまとめて禁止する指定も許す。

以降，行指定などを含む \(B\) を，最終的にひらがな1文字集合へ展開・正規化した集合を \(B^\*\) と表す。たとえば「あ行」を指定した場合は，\(B^\*=\{\text{あ},\text{い},\text{う},\text{え},\text{お}\}\) となる。複数指定がある場合は和集合として扱う。

### 3.1.2 出力の定義
出力は，日本語文 \(y\) である。\(y\) は，指定された禁止集合に関する制約を満たすことに加えて，日本語として自然に読めること，および元文 \(x\) の主要な意味内容を大きく損なわないことが望ましい。本研究では，制約遵守を必須要件（違反は失敗）として扱い，意味保持・自然性は品質要件として評価指標により測定する。

制約遵守には二つの定義を用意し，目的に応じて使い分ける。

1. 表記ベース制約：出力文 \(y\) の表層文字列に禁止集合 \(B^\*\) が一切含まれない。
2. 読みベース制約：出力文 \(y\) を形態素解析して得られる読みの仮名列に，禁止集合 \(B^\*\) が一切含まれない。

以降の実験では，漢字表記の違いをまたいだ禁止音の回避を扱うため，読みベース制約を主制約として採用する。

### 3.1.3 文法性・意味保持要件
文法性・自然性とは，出力文 \(y\) が日本語として自然に読めることを指す。多少の文体変化（丁寧体から常体への変化など）は許容しうるが，意味解釈が困難になるほどの語順・活用の破綻は望ましくない。

意味保持とは，出力文 \(y\) が元文 \(x\) の主要な意味内容を保っていることを指す。完全な同義を要求するのではなく，「言い換えとして許容できる範囲で意味が対応している」ことを目標とする。意味保持と自然性の評価方法（自動指標・主観評価）は第6章で述べる。

### 3.1.4 前提とスコープ（読みを取れば制御できる、の扱い）
本研究は，禁止集合を「ひらがな」により与える。句読点・記号・英数字などは，禁止集合の対象外とする。また，本研究の主タスクは文単位のリライト／生成とし，段落や長文への適用は今後課題として扱う。

読みベース制約は，形態素解析器が返す各トークンの読み（多くの場合カタカナ）を，ひらがなへ正規化した仮名列に対して課す。ここで，ひらがなへの正規化とは，カタカナを対応するひらがなへ変換する処理を指す。読みを連結して得られる仮名列を \(\mathrm{Read}(y)\) とする。

形態素解析では未知語・解析失敗が起こりうるため，本研究では安全側の扱いとして「読みが取得できないトークンが存在する場合，その出力は読みベース制約の判定に失敗（違反）とみなし，再生成・再書き換えの対象とする」と定める。

## 3.2 制約の種類

本節では，本研究で用いる制約の種類を整理する。表記ベース制約と読みベース制約を定義した上で，実験で扱う制約強度（単音禁止／行禁止）を位置づける。

### 3.2.1 文字ベース制約
表記ベース制約は，出力文 \(y\) の表層文字列に禁止集合 \(B^\*\) が一切含まれないこととして定義する。ここで，禁止集合がひらがなで与えられることを踏まえ，表層文字列は必要に応じて正規化（例：カタカナをひらがなへ変換）した上で検査する。正規化後の表層文字列を \(\mathrm{Surf}(y)\) とし，\(\mathrm{Surf}(y)\) に \(B^\*\) の要素が含まれないことを表記ベース制約の成功条件とする。

### 3.2.2 読みベース制約
読みベース制約は，\(\mathrm{Read}(y)\) に禁止集合 \(B^\*\) が一切含まれないこととして定義する。具体的な判定手順は次の通りである。

1. 出力文 \(y\) を形態素解析し，トークン列を得る。
2. 各トークンに対して読みを取得し，ひらがなへ正規化する。
3. 正規化後の読みを連結して \(\mathrm{Read}(y)\) を得る。
4. \(\mathrm{Read}(y)\) に \(B^\*\) の要素が含まれるかを検査する。

日本語では同一表記に複数の読みがありうるが，本研究では形態素解析器が返す読みを採用し，その出力に従って判定する。読みが取得できない場合は前節の規定に従い失敗とみなす。

### 3.2.3 制約強度
本研究では，禁止集合の大きさや，禁止される仮名の頻度に応じて制約の強度が変化すると考える。実験では，単音禁止（例：ひらがな1文字の禁止）を比較的弱い制約，行禁止（例：「あ行」の禁止）をより強い制約として扱い，これらを条件として比較する。

## 3.3 評価基準（指標の定義）

本節では，本研究で用いる評価指標を定義する。制約遵守率を主指標として位置づけ，意味保持・自然性・書き換えの性質・計算コストを補助指標として扱う。
本研究は，制約遵守（違反ゼロ）を最優先の要件として扱い，制約遵守率を主指標とする。制約遵守率（Constraint Satisfaction Rate）は，評価対象の入力集合に対して，制約を満たす出力が得られた割合として定義する。読みベース制約を主制約とする場合は，\(\mathrm{Read}(y)\) に禁止集合が含まれない出力の割合を指す。

補助指標として，(i) 意味保持，(ii) 文法性・自然性，(iii) 書き換えの性質（語彙置換率など），(iv) 計算コスト（実行時間や再試行回数）を用い，主指標とのトレードオフを議論する。各指標の具体的な計算方法と測定手順は第6章で述べる。

## 3.4 サブタスク

本節では，同一枠組み内で比較する生成方式（oneshot / sequential）と，再生成・局所修正をサブタスクとして整理する。
本研究は，同一の枠組み内で次のサブタスク（生成方式）を扱う。

1. 一発生成（oneshot）：元文 \(x\) と禁止集合 \(B^\*\) をまとめてLLMへ与え，1回の生成で出力文 \(y\) を得る。失敗時は基本的に全文の再生成を行う。
2. 逐次生成（sequential）：形態素解析により違反箇所を検出し，違反を含むトークン（または局所区間）に対して順次言い換えを行う。各ステップで再検査し，必要に応じて再試行する。
3. 再生成・局所修正：制約違反や品質不足が検出された場合に，プロンプトや対象範囲を調整しながら再生成・修正を反復する。

## 3.5 研究課題（Research Questions）
本研究では，以下の研究課題（Research Question; RQ）を設定し，評価指標と実験条件により検証する。

- RQ1：日本語リポグラム生成において，逐次生成方式（sequential）は一発生成方式（oneshot）に比べて，どの程度制約遵守率を改善できるか。
- RQ2：制約遵守を満たしたうえで，元文の意味保持や自然さをどの程度保てるか。その際，書き換えの性質（例：語彙置換率や語彙多様性）にはどのような差が生じるか。
- RQ3：制約タイプ（単音禁止／行禁止など）や文長・文ジャンルの違いによって，両方式の得意・不得意はどのように変化するか。
