# 第5章 実験設定と結果

本章では、日本語リポグラム生成手法の評価に用いたデータセットと実験条件、および現時点で得られている定量的な結果とその解釈について述べる。

## 5.1 データセットと実験条件

実験には、第3章3.2節および3.3節で定義した制約付きデータセットをそのまま用いた。

モデルには OpenAI の GPT 系 LLM（gpt-4.1-nano）を用い（OpenAI, 2025）、実験時点ではこの 1 種類のモデルを基準とした。oneshot と sequential の双方について、温度やトップ確率などの生成パラメータは共通設定とし、各パターンに対して 1 回ずつ生成を行った。生成と評価は専用のバッチスクリプトにより自動化し、その結果を行ごとのレコードを持つ表形式データとして保存した。

評価指標としては、第3章で定義した読みベース制約遵守率を主指標としつつ、語彙置換率（VRR）、語彙多様性（TTR）、n-gram 反復率、実行時間を併用した。評価用データセットの一部を図2に示す。

（図2: データセットのイメージ（例：元文と禁止文字集合の組をいくつか示したキャプチャ）をこのあたりに配置）

## 5.2 制約遵守率と方式比較（主指標；図3，図4）

まず、読みベース制約遵守率を主指標として、oneshot と sequential を比較した。全体で見ると、sequential が oneshot を大きく上回ることが明らかになった。具体的な数値はここでは省略するが、イメージとしては sequential が 9 割前後の成功率を示す一方、oneshot は 1 割前後にとどまる、といった大きな差である。全体の成功率の比較は図3に示す。
詳細な成功率（成功数・総数）は付録Aの表A2に示す。

各 id ごとに「どちらが成功したか」を比較すると、sequential のみ成功したペアが大多数を占め、両方式とも成功または失敗となる「同じ結果」のペアが残りを構成する。oneshot のみが成功した例はほとんど見られず、対応のある t 検定でも、成功フラグ（0/1）の差は統計的に有意な差が確認された。とくに行禁止（medium）条件で差が顕著であり、厳しい制約下では sequential の優位性が際立つ結果となった。制約タイプ（easy / medium）ごとの成功率の違いは図4に示す。

（図3: 手法ごとの全体の制約遵守率を比較する棒グラフ。中間報告で用いた success_by_method（ファイル例: `results/success_by_method.png`）に対応する図をこのあたりに配置）  
（図4: 制約タイプ別（easy / medium）の制約遵守率を比較する棒グラフ。中間報告で用いた success_by_constraint_type（ファイル例: `results/success_by_constraint_type.png`）に対応する図をこのあたりに配置）

## 5.3 補助指標と実行時間（図5，図6）

次に、制約を満たしたケースに限定して、語彙置換率（VRR）や語彙多様性（TTR）、実行時間などの補助指標を比較した。両方式とも制約を満たしたペアに絞って VRR を比較すると、oneshot の VRR が sequential より有意に高く、より大きな言い換えを行う傾向があることが分かった。VRR の分布を手法ごとに比較した結果は図5に示す。一方、TTR については両方式で大きな差は見られず、語彙多様性そのものは同程度であることが示唆された。

また、VRR と制約遵守の関係を見るために、VRR の値と成功・失敗フラグの関係をプロットした結果を図6に示す。VRR が高いほど制約を守るのが難しくなる傾向があり、「大きく言い換えるほど失敗しやすい」という直感に対応する結果となっている。

これらを総合すると、「制約を守りながら元文に近い表現を保つ」という観点では sequential が優位であり、「大胆に言い換えるが制約違反も起こしやすい」のが oneshot という性質が浮かび上がる。実行時間については、sequential が oneshot より長くなるのは当然であるが、制約タイプや文長によって増加幅がどの程度変化するかを確認したところ、medium 条件や長文ほどコストが増大する傾向が見られた。

（図5: 制約を満たしたケースにおける VRR の分布（手法ごとの箱ひげ図など）。中間報告で用いた vrr_box_both_success（ファイル例: `results/vrr_box_both_success.png`）に対応する図をこのあたりに配置）  
（図6: VRR と制約遵守成否（success / failure）の関係を示す散布図。中間報告で用いた success_vs_vrr あるいは vrr_ttr_scatter_both_success（ファイル例: `results/success_vs_vrr.png` など）に対応する図をこのあたりに配置）

## 5.4 エラー分析

定量的な指標に加えて、代表例を用いたエラー分析も行った。oneshot 手法の典型的な失敗パターンとしては、禁止文字が 1〜2 文字だけ残るケースや、助詞や頻出語に禁止文字が含まれているにもかかわらず十分に書き換えられていないケースが多く見られた。また、行禁止条件では、使用可能な語彙が大きく制限される結果として、意味が原文から大きく逸脱する例も確認された。

sequential 手法でも、制約が極端に厳しい場合や、読みベース制約によって漢字語の読みが強く制限される場合などには、再生成を繰り返しても自然な表現にたどり着けないケースが存在した。局所的な修正を重ねるうちに、文全体の統一感がやや損なわれる例もあり、逐次生成ならではの課題も浮かび上がっている。

図7に、代表的な成功例・失敗例をいくつか示す。oneshot では文全体を丸ごと言い換える過程で意味が原文から大きく逸脱してしまう例があり、sequential では局所的な修正を重ねるうちに文全体の統一感がやや損なわれる例が見られた。これらの事例は、第4章で述べた Web アプリケーション上で元文・制約・両方式の出力を並べて提示することで、今後の主観評価や改善策の検討に活用できる。

（図7: 成功例・失敗例（元文／制約／各方式の出力）を並べた図。このあたりに配置）
